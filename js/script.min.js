!function(){"use strict";async function e(e){let r=await fetch(e);return await r.json()}let r=document.querySelector("tbody"),a=document.querySelector("canvas"),i=document.querySelector("audio"),o=a.getContext("2d");async function t({visible:e,src:r,posX:i=0,posY:t=0,originX:n=0,originY:s=0,frameX:l=0,frameY:m=0,frameRegX:c=0,frameRegY:u=0,frameW:d=0,frameH:f=0,alpha:g=1}){if(!1===e)return;if("canvas"==r)return a.width=d,void(a.height=f);let y=await function(e){let r=new Image;return new Promise(((a,i)=>{r.onload=()=>{a(r)},r.src=e}))}(r);o.globalAlpha=g,o.drawImage(y,l-c,m-u,d,f,i-n,t-s,d,f)}async function n(){for(let e of a.layers)await t(e)}function s(){function e(e,r,a,i){let o=document.createElement("input");return e.insertCell().appendChild(o),o.disabled=null==a||"canvas"==a,o.id=o.name=r,o.type=i,"checkbox"==i?o.checked="boolean"!=typeof a||a:o.value=a,o.onchange=function(){this.layer[this.id]="checkbox"==this.type?this.checked:this.value,console.log(this.id,this.layer),n()},o}function i(a){let{immoveable:i,visible:o,src:t,posX:n,posY:s,originX:l,originY:m,frameNo:c,frameX:u,frameY:d,frameRegX:f,frameRegY:g,frameW:y,frameH:h}=a,p=r.insertRow();i&&p.classList.add("immoveable"),function(e,r){let a=document.createElement("div"),i=e.insertCell();i.appendChild(a),i.classList.add("drag-widget"),r||a.classList.add("burger")}(p,i),e(p,"visible",o,"checkbox").layer=a,e(p,"src",t,"url").layer=a,e(p,"posX",n,"number").layer=a,e(p,"posY",s,"number").layer=a,e(p,"originX",l,"number").layer=a,e(p,"originY",m,"number").layer=a,e(p,"frameNo",c,"number").layer=a,e(p,"frameX",u,"number").layer=a,e(p,"frameY",d,"number").layer=a,e(p,"frameRegX",f,"number").layer=a,e(p,"frameRegY",g,"number").layer=a,e(p,"frameW",y,"number").layer=a,e(p,"frameH",h,"number").layer=a}r.innerHTML="";for(let e of a.layers)i(e);sortable("#layers",{items:":not(.immoveable)"})[0].addEventListener("sortstop",(function(e){n()}))}async function l(){let{value:r,room:o}=this.selectedOptions[0];console.log(r,o),a.room=o,a.layers=[],this.frame||(this.frame=0),a.layers.push({immoveable:!0,src:"canvas",frameW:o.width,frameH:o.height});let t=o.spriteSheet="string"==typeof o.spriteSheet?await e(o.spriteSheet):o.spriteSheet,l=o.layout;if(a.layers.push({immoveable:!0,visible:!0,src:o.media.background,posX:0,posY:0,originX:0,originY:0,frameW:o.width,frameH:o.height}),i.src=o.media.music||"",l&&(Array.isArray(l.playground)&&Array.isArray(l.playground[0])&&(l.playground=[].concat.apply([],l.playground)),l.playground.sort(((e,r)=>e.y-r.y))),l.playground.sort(((e,r)=>e.y-r.y)),l&&t.images)for(let e in l.playground){let r=l.playground[e];if(void 0===r){console.log(`Playground ${e} has no placement`);continue}let i=t.animations[r.id];if(void 0===i){console.log(`Playground ${e},placement ${r.id} has no animation`);continue}let o=i.frames.map((e=>t.frames[e])),n=o[0];a.layers.push({frames:o,visible:!0,src:t.images[n[4]],posX:r.x,posY:r.y,originX:r.regX,originY:r.regY,frameNo:0,frameX:n[0],frameY:n[1],frameRegX:n[5],frameRegY:n[6],frameW:n[2],frameH:n[3]})}a.layers.push({immoveable:!0,visible:!0,src:o.media.foreground,posX:0,posY:0,originX:0,originY:0,frameW:o.width,frameH:o.height}),a.layers.push({immoveable:!0,visible:!1,src:o.media.navMesh,posX:0,posY:0,originX:0,originY:0,frameW:o.width,frameH:o.height,alpha:.5}),a.layers.push({immoveable:!0,visible:!1,src:o.media.treasure,posX:0,posY:0,originX:0,originY:0,frameW:o.width,frameH:o.height,alpha:.5}),s(),n()}async function m(){let r=document.getElementById("select-room"),a=await async function(r){let a=await e("https://api.boxcrittersmods.ga/manifests");return await e(a[r].src)}("rooms");for(var i of(r.addEventListener("change",l),a)){i.roomId=i.roomId||i.id,i.name=i.name||i.roomId;let e=document.createElement("option");e.value=i.roomId,e.text=i.name,e.room=i,r.add(e,null)}l.call(r)}a.style.height="100%",setTimeout((()=>{m()}),10)}();
//# sourceMappingURL=script.min.js.map